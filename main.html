<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>幸運大抽獎</title>
    <style>
        :root { --primary: #3498db; --bg: #f5f6fa; }
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; }
        .card { background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 30px; width: 100%; max-width: 450px; text-align: center; }
        
        /* 轉盤視覺 */
        .wheel-box { position: relative; margin: 20px auto; width: 300px; height: 300px; }
        .pointer { 
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%); 
            width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; 
            border-top: 30px solid #e74c3c; z-index: 10; 
        }
        #wheel { 
            width: 100%; height: 100%; border-radius: 50%; border: 6px solid #2f3640; 
            transition: transform 3.5s cubic-bezier(0.1, 0, 0, 1);
            background: #fff; 
        }

        /* 輸入區域 */
        .input-list { margin-top: 25px; max-height: 250px; overflow-y: auto; padding: 5px; }
        .row { display: flex; gap: 8px; margin-bottom: 10px; align-items: center; }
        .row input { 
            flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; 
            font-size: 15px; background: #fff; transition: 0.2s;
        }
        .row input:focus { border-color: var(--primary); outline: none; background: #fdfdfd; }
        
        .btn-del { background: #eee; color: #999; border: none; width: 35px; height: 35px; border-radius: 8px; cursor: pointer; font-size: 18px; }
        .btn-del:hover { background: #ff7675; color: white; }

        .controls { display: flex; gap: 12px; margin-top: 25px; }
        button.main-btn { flex: 1; padding: 14px; border: none; border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.2s; }
        .btn-add { background: #f1f2f6; color: #2f3640; border: 1px solid #ddd; }
        .btn-add:hover { background: #dfe4ea; }
        .btn-spin { background: var(--primary); color: white; }
        .btn-spin:active { transform: scale(0.96); }
        .btn-spin:disabled { background: #bdc3c7; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="margin:0 0 5px 0;">幸運大轉盤</h2>
    <p style="font-size:14px; color:#7f8c8d;">請輸入選項後開始抽獎</p>

    <div class="wheel-box">
        <div class="pointer"></div>
        <canvas id="wheel" width="400" height="400"></canvas>
    </div>

    <div class="input-list" id="inputContainer">
        <div class="row">
            <input type="text" class="opt-input" value="大獎" oninput="draw()">
            <div style="width:35px"></div> </div>
        <div class="row">
            <input type="text" class="opt-input" value="謝謝參與" oninput="draw()">
            <button class="btn-del" onclick="removeRow(this)">×</button>
        </div>
        <div class="row">
            <input type="text" class="opt-input" value="再來一次" oninput="draw()">
            <button class="btn-del" onclick="removeRow(this)">×</button>
        </div>
    </div>

    <div class="controls">
        <button class="main-btn btn-add" onclick="addRow()">新增選項</button>
        <button class="main-btn btn-spin" id="spinBtn" onclick="spin()">立即抽獎</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const colors = ['#3498db', '#1abc9c', '#f1c40f', '#e67e22', '#9b59b6', '#34495e', '#2ecc71'];
    let currentTotalDeg = 0;

    function draw() {
        const inputs = document.querySelectorAll('.opt-input');
        const count = inputs.length;
        const arc = (2 * Math.PI) / count;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        inputs.forEach((input, i) => {
            const angle = i * arc;
            ctx.beginPath();
            ctx.fillStyle = colors[i % colors.length];
            ctx.moveTo(200, 200);
            ctx.arc(200, 200, 200, angle, angle + arc);
            ctx.fill();
            ctx.strokeStyle = "rgba(255,255,255,0.3)";
            ctx.stroke();

            ctx.save();
            ctx.translate(200, 200);
            ctx.rotate(angle + arc / 2);
            ctx.textAlign = "right";
            ctx.fillStyle = "#fff";
            ctx.font = "bold 20px sans-serif";
            ctx.fillText(input.value.substring(0, 10), 180, 10);
            ctx.restore();
        });
    }

    function addRow() {
        const container = document.getElementById('inputContainer');
        const div = document.createElement('div');
        div.className = 'row';
        div.innerHTML = `
            <input type="text" class="opt-input" placeholder="請輸入選項" oninput="draw()">
            <button class="btn-del" onclick="removeRow(this)">×</button>
        `;
        container.appendChild(div);
        draw();
    }

    function removeRow(btn) {
        btn.parentElement.remove();
        draw();
    }

    function spin() {
        const inputs = document.querySelectorAll('.opt-input');
        if (inputs.length < 1) return;

        const btn = document.getElementById('spinBtn');
        const wheel = document.getElementById('wheel');
        const arcDeg = 360 / inputs.length;

        btn.disabled = true;

        // 旋轉 25-30 圈
        const spins = (25 + Math.floor(Math.random() * 5)) * 360;
        
        // 隨機落點（第一格範圍內）
        const randomOffset = (Math.random() * (arcDeg * 0.6)) + (arcDeg * 0.2);
        
        const currentRest = currentTotalDeg % 360;
        let targetPos = 270 - randomOffset;
        let compensation = targetPos - currentRest;
        if (compensation <= 0) compensation += 360;

        currentTotalDeg += (spins + compensation);
        wheel.style.transform = `rotate(${currentTotalDeg}deg)`;

        setTimeout(() => {
            alert(`恭喜獲得：${inputs[0].value}`);
            btn.disabled = false;
        }, 3600);
    }

    draw();
</script>

</body>
</html>
