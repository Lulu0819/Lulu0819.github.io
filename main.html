<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…æ“¬çœŸæŠ½çæ©Ÿ</title>
    <style>
        :root { --primary: #3498db; --bg: #f5f6fa; }
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; }
        .card { background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 30px; width: 100%; max-width: 450px; text-align: center; }
        
        /* è½‰ç›¤è¦–è¦º */
        .wheel-box { position: relative; margin: 20px auto; width: 300px; height: 300px; }
        .pointer { 
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%); 
            width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; 
            border-top: 30px solid #e74c3c; z-index: 10; 
        }
        #wheel { 
            width: 100%; height: 100%; border-radius: 50%; border: 6px solid #2f3640; 
            transition: transform 3.5s cubic-bezier(0.1, 0, 0, 1);
            background: #fff; 
        }

        /* è¼¸å…¥å€åŸŸ */
        .input-list { margin-top: 25px; max-height: 250px; overflow-y: auto; padding: 5px; }
        .row { display: flex; gap: 8px; margin-bottom: 10px; align-items: center; }
        .row input { 
            flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; 
            font-size: 15px; background: #fff; transition: 0.2s;
        }
        .row input:focus { border-color: var(--primary); outline: none; background: #fdfdfd; }
        
        .btn-del { background: #eee; color: #999; border: none; width: 35px; height: 35px; border-radius: 8px; cursor: pointer; font-size: 18px; }
        .btn-del:hover { background: #ff7675; color: white; }

        /* é›™æŒ‰éˆ•å½è£æˆä¸€å€‹æŒ‰éˆ• */
        .controls { 
            display: flex; margin-top: 25px; width: 100%;
            background: var(--primary); /* æ•´å€‹æŒ‰éˆ•çš„èƒŒæ™¯ */
            border-radius: 10px; 
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
            overflow: hidden; /* ç¢ºä¿é‚Šè§’åœ“æ½¤ */
            position: relative;
        }
        .controls button {
            flex: 1; padding: 14px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; 
            background: none; /* è®“å­æŒ‰éˆ•æ²’æœ‰è‡ªå·±çš„èƒŒæ™¯ */
            color: white; 
            transition: background-color 0.2s, transform 0.2s;
        }
        /* ä¸­é–“åˆ†éš”ç·šï¼Œç”¨æ–¼è¦–è¦ºæç¤ºï¼Œè®“æœ‹å‹ä»¥ç‚ºæ˜¯å–®ä¸€æŒ‰éˆ• */
        .controls button:first-child { 
            border-right: 1px solid rgba(255,255,255,0.3); /* è¼•å¾®åˆ†éš” */
        }
        .controls button:hover { background-color: rgba(0,0,0,0.1); }
        .controls button:active { transform: scale(0.98); }
        .controls button:disabled { background: #bdc3c7; cursor: not-allowed; }

        .btn-add { 
            margin-top: 15px; width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px;
            background: #f1f2f6; color: #2f3640; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .btn-add:hover { background: #dfe4ea; }

    </style>
</head>
<body>

<div class="card">
    <h2 style="margin:0 0 5px 0;">å¹¸é‹å¤§è½‰ç›¤</h2>
    <p style="font-size:14px; color:#7f8c8d;">è«‹è¼¸å…¥é¸é …å¾Œé»æ“ŠæŠ½çæŒ‰éˆ•</p>

    <div class="wheel-box">
        <div class="pointer"></div>
        <canvas id="wheel" width="400" height="400"></canvas>
    </div>

    <div class="input-list" id="inputContainer">
        <div class="row">
            <input type="text" class="opt-input" value="å¤§ç" oninput="draw()">
            <div style="width:35px; opacity:0;"></div> </div>
        <div class="row">
            <input type="text" class="opt-input" value="è¬è¬åƒèˆ‡" oninput="draw()">
            <button class="btn-del" onclick="removeRow(this)">Ã—</button>
        </div>
        <div class="row">
            <input type="text" class="opt-input" value="å†ä¾†ä¸€æ¬¡" oninput="draw()">
            <button class="btn-del" onclick="removeRow(this)">Ã—</button>
        </div>
    </div>

    <button class="btn-add" onclick="addRow()">æ–°å¢é¸é …</button>
    
    <div class="controls" id="spinControl" onclick="handleSpin(event)">
        <button type="button" id="leftSpinBtn">å…¬å¹³æŠ½ç</button>
        <button type="button" id="rightSpinBtn">å¹¸é‹æŠ½ç</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const colors = ['#3498db', '#1abc9c', '#f1c40f', '#e67e22', '#9b59b6', '#34495e', '#2ecc71', '#e74c3c']; // å¢åŠ é¡è‰²
    let currentTotalDeg = 0; // ç´¯è¨ˆè§’åº¦ï¼Œé˜²æ­¢è½‰ç›¤å€’è½‰

    function draw() {
        const inputs = document.querySelectorAll('.opt-input');
        const count = inputs.length;
        // å¦‚æœæ²’æœ‰é¸é …ï¼Œä¸ç¹ªè£½è½‰ç›¤
        if (count === 0) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            return;
        }
        
        const arc = (2 * Math.PI) / count;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        inputs.forEach((input, i) => {
            const angle = i * arc;
            ctx.beginPath();
            ctx.fillStyle = colors[i % colors.length];
            ctx.moveTo(200, 200);
            ctx.arc(200, 200, 200, angle, angle + arc);
            ctx.fill();
            ctx.strokeStyle = "rgba(255,255,255,0.3)";
            ctx.stroke();

            ctx.save();
            ctx.translate(200, 200);
            ctx.rotate(angle + arc / 2);
            ctx.textAlign = "right";
            ctx.fillStyle = "#fff";
            ctx.font = "bold 20px sans-serif";
            ctx.fillText(input.value.substring(0, 10), 180, 10);
            ctx.restore();
        });
    }

    function addRow() {
        const container = document.getElementById('inputContainer');
        const div = document.createElement('div');
        div.className = 'row';
        div.innerHTML = `
            <input type="text" class="opt-input" placeholder="è«‹è¼¸å…¥é¸é …" oninput="draw()">
            <button class="btn-del" onclick="removeRow(this)">Ã—</button>
        `;
        container.appendChild(div);
        draw();
    }

    function removeRow(btn) {
        btn.parentElement.remove();
        draw();
    }

    // çœŸæ­£çš„æŠ½çé‚è¼¯ (å¯ä»¥é¸æ“‡ç‰¹å®šé¸é …ï¼Œæˆ–éš¨æ©Ÿ)
    function spinWheel(isCheated) {
        const inputs = document.querySelectorAll('.opt-input');
        if (inputs.length < 1) {
            alert("è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹é¸é …ï¼");
            return;
        }

        const spinButtons = document.querySelectorAll('#spinControl button');
        const wheel = document.getElementById('wheel');
        const arcDeg = 360 / inputs.length;

        // ç¦ç”¨æŒ‰éˆ•
        spinButtons.forEach(btn => btn.disabled = true);

        // æ—‹è½‰ 25-30 åœˆï¼Œè¦–è¦ºä¸Šæ¥µå¿«
        const spins = (25 + Math.floor(Math.random() * 5)) * 360;
        
        let targetIndex = 0; // é è¨­ç‚ºç¬¬ä¸€å€‹é¸é … (ä½œå¼Šæ¨¡å¼)
        if (!isCheated) {
            // å…¬å¹³æ¨¡å¼ï¼šéš¨æ©Ÿé¸æ“‡ä¸€å€‹ç´¢å¼•
            targetIndex = Math.floor(Math.random() * inputs.length);
        }

        // è¨ˆç®—ç›®æ¨™é¸é …çš„ä¸­å¿ƒè§’åº¦ (è½‰ç›¤åº§æ¨™ç³»)
        // è½‰ç›¤ 0 åº¦åœ¨å³å´(3é»é˜)ï¼ŒæŒ‡é‡åœ¨ä¸Šæ–¹(270åº¦)
        const targetCenterAngle = (targetIndex * arcDeg + arcDeg / 2);

        // éš¨æ©Ÿåç§»é‡ï¼Œè®“æŒ‡é‡åœåœ¨ç›®æ¨™æ ¼å…§çš„éš¨æ©Ÿä½ç½® (æ›´è‡ªç„¶)
        const randomInArc = (Math.random() * (arcDeg * 0.6)) + (arcDeg * 0.2);
        
        // è¨ˆç®—æœ¬æ¬¡æ—‹è½‰è§’åº¦ï¼ˆè€ƒæ…®åˆ°ç´¯è¨ˆè§’åº¦ï¼Œé¿å…å€’è½‰ï¼‰
        const currentRest = currentTotalDeg % 360;
        
        // æˆ‘å€‘è¦è®“ targetIndex çš„å€åŸŸåœåœ¨æŒ‡é‡ (270åº¦) çš„ä½ç½®
        // æ‰€ä»¥æœ€çµ‚çš„æ—‹è½‰è§’åº¦ = 270åº¦ - (targetIndex å°æ‡‰çš„è§’åº¦ + éš¨æ©Ÿåç§»)
        // é€™è£¡éœ€è¦ç¨å¾®èª¿æ•´ä¸€ä¸‹ï¼Œå› ç‚ºè½‰ç›¤æ˜¯é †æ™‚é‡è½‰ï¼Œä½†ç´¢å¼•æ˜¯å¾å³é–‹å§‹é€†æ™‚é‡
        // ç°¡å–®ä¾†èªªï¼Œæˆ‘å€‘è¦è½‰åˆ°è®“ targetIndex å‡ºç¾åœ¨ 270 åº¦
        
        // è®“ targetIndex è½‰åˆ°æŒ‡é‡çš„åº¦æ•¸ (é€†æ™‚é‡è¨ˆç®—)
        let rotationToTarget = (360 - targetCenterAngle) + 270 - randomInArc;
        
        // ç¢ºä¿ rotationToTarget è½åœ¨ 0-360 ä¹‹é–“
        rotationToTarget = (rotationToTarget + 360) % 360; 

        let compensation = rotationToTarget - currentRest;
        if (compensation < 0) compensation += 360; // ç¢ºä¿æ˜¯é †æ™‚é‡å¢åŠ 

        currentTotalDeg += (spins + compensation);
        
        wheel.style.transform = `rotate(${currentTotalDeg}deg)`;

        // çµæœå›é¥‹
        setTimeout(() => {
            alert(`ğŸ‰ æ­å–œç²å¾—ï¼š${inputs[targetIndex].value} ğŸ‰`);
            spinButtons.forEach(btn => btn.disabled = false);
        }, 3600); // å‹•ç•« 3.5s + 0.1s ç·©è¡
    }

    // è™•ç†é»æ“Šäº‹ä»¶ï¼Œåˆ¤æ–·æ˜¯å·¦é‚Šé‚„æ˜¯å³é‚Š
    function handleSpin(event) {
        const targetElement = event.currentTarget;
        const rect = targetElement.getBoundingClientRect();
        const clickX = event.clientX - rect.left; // ç›¸å°æ–¼æŒ‰éˆ•çš„ X åº§æ¨™

        if (clickX < rect.width / 2) {
            // é»æ“Šäº†å·¦åŠé‚Š (å…¬å¹³æŠ½ç)
            spinWheel(false); 
        } else {
            // é»æ“Šäº†å³åŠé‚Š (ä½œå¼ŠæŠ½ç)
            spinWheel(true); 
        }
    }

    // åˆå§‹åŒ–
    draw();
</script>

</body>
</html>
