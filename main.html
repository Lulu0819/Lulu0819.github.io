<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿…ä¸­æ¥µé€Ÿè½‰ç›¤ - å°ˆæ¥­ç‰ˆ</title>
    <style>
        :root { --primary: #6c5ce7; --accent: #ff7675; --bg: #f1f2f6; }
        body { font-family: 'PingFang TC', sans-serif; background: var(--bg); display: flex; justify-content: center; padding: 20px; }
        .card { background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 25px; width: 100%; max-width: 500px; text-align: center; }
        
        /* è½‰ç›¤è¦–è¦ºèˆ‡æ¥µé€Ÿå‹•ç•« */
        .wheel-box { position: relative; margin: 20px auto; width: 300px; height: 300px; }
        .pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid #d63031; z-index: 10; }
        #wheel { 
            width: 100%; height: 100%; border-radius: 50%; border: 6px solid #2d3436; 
            transition: transform 3.5s cubic-bezier(0.1, 0, 0, 1); /* æ¥µé€Ÿå•Ÿå‹•æ›²ç·š */
            background: #fff; 
        }

        /* è¼¸å…¥å€åŸŸ */
        .input-list { margin-top: 20px; max-height: 300px; overflow-y: auto; padding-right: 5px; }
        .row { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; }
        .row input { flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; }
        .row input:focus { border-color: var(--primary); outline: none; }
        .row .target-label { background: #ffeaa7; color: #d35400; font-weight: bold; padding: 10px; border-radius: 8px; font-size: 12px; }
        
        .btn-del { background: #fab1a0; color: #e17055; border: none; width: 35px; height: 35px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-del:hover { background: var(--accent); color: white; }

        .controls { display: flex; gap: 10px; margin-top: 20px; }
        button.main-btn { flex: 1; padding: 12px; border: none; border-radius: 12px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.2s; }
        .btn-add { background: #55efc4; color: #00b894; }
        .btn-spin { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(108, 92, 231, 0.3); }
        button:active { transform: scale(0.95); }
        button:disabled { background: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="margin:0 0 10px 0;">ğŸ¡ æ¥µé€Ÿå¿…ä¸­è½‰ç›¤</h2>
    <p style="font-size:13px; color:#636e72;">æç¤ºï¼šè½‰ç›¤çµæœæ°¸é æ˜¯åˆ—è¡¨ä¸­çš„ã€Œç¬¬ä¸€é …ã€</p>

    <div class="wheel-box">
        <div class="pointer"></div>
        <canvas id="wheel" width="400" height="400"></canvas>
    </div>

    <div class="input-list" id="inputContainer">
        <div class="row">
            <span class="target-label">å¿…ä¸­</span>
            <input type="text" class="opt-input" value="é ­ç iPhone 15" oninput="draw()">
        </div>
        <div class="row">
            <input type="text" class="opt-input" value="éŠ˜è¬æƒ é¡§" oninput="draw()">
            <button class="btn-del" onclick="removeRow(this)">âœ•</button>
        </div>
    </div>

    <div class="controls">
        <button class="main-btn btn-add" onclick="addRow()">â• æ–°å¢é¸é …</button>
        <button class="main-btn btn-spin" id="spinBtn" onclick="spin()">ğŸ”¥ æ¥µé€Ÿé–‹è½‰</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const colors = ['#6c5ce7', '#00cec9', '#fab1a0', '#fd79a8', '#ffeaa7', '#a29bfe', '#55efc4'];
    let currentTotalDeg = 0;

    // ç¹ªè£½è½‰ç›¤
    function draw() {
        const inputs = document.querySelectorAll('.opt-input');
        const count = inputs.length;
        const arc = (2 * Math.PI) / count;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        inputs.forEach((input, i) => {
            const angle = i * arc;
            // æ‰‡å½¢
            ctx.beginPath();
            ctx.fillStyle = colors[i % colors.length];
            ctx.moveTo(200, 200);
            ctx.arc(200, 200, 200, angle, angle + arc);
            ctx.fill();
            ctx.strokeStyle = "rgba(255,255,255,0.5)";
            ctx.stroke();

            // æ–‡å­—
            ctx.save();
            ctx.translate(200, 200);
            ctx.rotate(angle + arc / 2);
            ctx.textAlign = "right";
            ctx.fillStyle = "#fff";
            ctx.font = "bold 20px sans-serif";
            // åªå–å‰10å€‹å­—é¿å…çˆ†å‡ºå»
            ctx.fillText(input.value.substring(0, 10) || `é¸é … ${i+1}`, 180, 10);
            ctx.restore();
        });
    }

    // æ–°å¢é¸é … (ç„¡é™å¢åŠ )
    function addRow() {
        const container = document.getElementById('inputContainer');
        const div = document.createElement('div');
        div.className = 'row';
        div.innerHTML = `
            <input type="text" class="opt-input" placeholder="æ–°é¸é …..." oninput="draw()">
            <button class="btn-del" onclick="removeRow(this)">âœ•</button>
        `;
        container.appendChild(div);
        draw();
    }

    // åˆªé™¤é¸é … (é˜²éŒ¯ï¼šç¬¬ä¸€å€‹ä¸æœƒæœ‰åˆªé™¤éˆ•)
    function removeRow(btn) {
        btn.parentElement.remove();
        draw();
    }

    // æ¥µé€Ÿå¿…ä¸­é‚è¼¯
    function spin() {
        const inputs = document.querySelectorAll('.opt-input');
        if (inputs.length < 1) return;

        const btn = document.getElementById('spinBtn');
        const wheel = document.getElementById('wheel');
        const count = inputs.length;
        const arcDeg = 360 / count;

        btn.disabled = true;

        // 1. å¢åŠ æ—‹è½‰åœˆæ•¸ (25-30åœˆï¼Œæ¥µå¿«)
        const spins = (25 + Math.floor(Math.random() * 5)) * 360;
        
        // 2. è¨ˆç®—è½é»ï¼šç¬¬ä¸€æ ¼(0åº¦)è¦å°æº–æŒ‡é‡(270åº¦)
        // éš¨æ©Ÿåç§»é‡è®“æŒ‡é‡åœåœ¨ç¬¬ä¸€æ ¼çš„ä¸åŒä½ç½®
        const randomOffset = (Math.random() * (arcDeg * 0.6)) + (arcDeg * 0.2);
        
        // 3. è¨ˆç®—æœ¬æ¬¡æ—‹è½‰è§’åº¦ï¼ˆè€ƒæ…®åˆ°ç´¯è¨ˆè§’åº¦ï¼Œé¿å…å€’è½‰ï¼‰
        const currentRest = currentTotalDeg % 360;
        let targetPos = 270 - randomOffset;
        let compensation = targetPos - currentRest;
        if (compensation <= 0) compensation += 360;

        currentTotalDeg += (spins + compensation);
        
        wheel.style.transform = `rotate(${currentTotalDeg}deg)`;

        // 4. çµæœå›é¥‹
        setTimeout(() => {
            alert(`âœ¨ æ­å–œç²å¾—ï¼š${inputs[0].value} âœ¨`);
            btn.disabled = false;
        }, 3600); // å‹•ç•« 3.5s + 0.1s ç·©è¡
    }

    // åˆå§‹åŒ–
    draw();
</script>

</body>
</html>
